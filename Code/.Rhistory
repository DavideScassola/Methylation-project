#cell_files <- list.files(directory,pattern="(_converted.Rda)$")
#cell_names <- sub("_converted.Rda","", cell_files)
#methylation_vector <- as.logical(readRDS("MethylationData/binary_rate/GSM3436261_O1_TA_Hi_10_converted.Rda"))
sample_msr(1e6, 0.5)
msr_samples(1e6, 0.05, 10, verbose = T)
msr_samples(1e5, 0.05, 10, verbose = T)
2*20*1e4
2*20*1e4/18
2*20*1e4/18/3600
2*25*1e4/18/3600
2*25*1e3/18/3600
2*25*4e3/18/3600
2*25*5e3/18/3600
2*25*1e4/18/3600
2*25*1e4/20/3600
#################################################################################################
setwd(dir = "Scrivania/Tesi/Methylation-project/Code/")
source("WGBS_analysis_functions.R", chdir = T)
data_H1 <- sum_strands(readRDS("../../MethylationCode/MethylationData/wgbs/H1.Rda"))
data_stomach <- sum_strands(readRDS("../../MethylationCode/MethylationData/wgbs/stomach.Rda"))
data_K562 <- sum_strands(readRDS("../../MethylationCode/MethylationData/wgbs/K562.Rda"))
data_HeLa <- sum_strands(readRDS("../../MethylationCode/MethylationData/wgbs/HeLa_S3.Rda"))
gc(full=T)
names = c("H1", "stomach", "HeLa_S3", "K562")
data_list = List(data_H1, data_stomach, data_HeLa, data_K562)
###################################################################
H1_enhancers      = readRDS("../../Rexperiments/H1_enhancers_data.Rda")
stomach_enhancers = readRDS("../../Rexperiments/stomach_enhancers_data.Rda")
K562_enhancers    = readRDS("../../Rexperiments/K562_enhancers_data.Rda")
HeLa_enhancers    = readRDS("../../Rexperiments/HeLa_S3_enhancers_data.Rda")
# Histograms
par(mfrow=c(2,2))
compare_meth_annotation_histograms(names, reads_name = "valid sites", title = "Enhancers methylation", min_reads = 10, y_max = 0.08, H1_enhancers, stomach_enhancers, HeLa_enhancers)#, K562_enhancers)
plot()
plot(c(1))
compare_meth_annotation_histograms(names, reads_name = "valid sites", title = "Enhancers methylation", min_reads = 10, y_max = 0.08, H1_enhancers, stomach_enhancers, HeLa_enhancers, K562_enhancers)
names = c("H1", "stomach", "HeLa-S3", "K562")
# Histograms
compare_meth_annotation_histograms(names, reads_name = "valid sites", title = "CG islands methylation", min_reads = 10, H1_islands, stomach_islands, HeLa_islands, K562_islands)
# Correlation
min_reads = 10
annotation_level_meth_correlation(H1_islands, stomach_islands, reads_name = "valid sites", min_reads=100)
compare_meth_annotation_histograms(names, reads_name = "valid sites", title = "Enhancers methylation", min_reads = 10, y_max = 0.08, H1_enhancers, stomach_enhancers, HeLa_enhancers, K562_enhancers)
compare_meth_annotation_histograms(names, reads_name = "valid sites", title = "Enhancers methylation", min_reads = 1, y_max = 0.08, H1_enhancers, stomach_enhancers, HeLa_enhancers, K562_enhancers)
View(H1_enhancers)
hist(H1_enhancers$`valid sites`)
hist(H1_enhancers$`valid sites`, breaks = 100)
# Histograms
par(mfrow=c(2,2))
compare_meth_annotation_histograms(names, reads_name = "valid sites", title = "Enhancers methylation", min_reads = 5, y_max = 0.08, H1_enhancers, stomach_enhancers, HeLa_enhancers, K562_enhancers)
compare_meth_annotation_histograms(names, reads_name = "valid sites", title = "Enhancers methylation", min_reads = 5, y_max = 0.08, H1_enhancers, stomach_enhancers, HeLa_enhancers, K562_enhancers)
compare_meth_annotation_histograms(names, reads_name = "valid sites", title = "Enhancers methylation", min_reads = 5, y_max = 0.08, H1_enhancers, stomach_enhancers, HeLa_enhancers, K562_enhancers)
# Histograms
par(mfrow=c(2,2))
compare_meth_annotation_histograms(names, reads_name = "valid sites", title = "Enhancers methylation", min_reads = 5, y_max = 0.08, H1_enhancers, stomach_enhancers, HeLa_enhancers, K562_enhancers)
# Correlation
min_reads = 10
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads)
# Correlation
min_reads = 5
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads)
# Histograms
par(mfrow=c(1,1))
# Correlation
min_reads = 5
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads)
annotation_level_meth_correlation(H1_enhancers, HeLa_enhancers,    reads_name = "valid sites", min_reads)
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads)
cor.test(c(1,2,3), c(2,2,9))
a = cor.test(c(1,2,3), c(2,2,9))
a$estimate
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %f, coherence: %f\%", cor.test(p1,p2)$estimate, round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %f, coherence: %f\%", cor.test(p1,p2)$estimate, round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %f, coherence: %f\%", cor.test(p1,p2)$estimate, round(coherent_sites_prop,3)))
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
}
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
}
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %f, coherence: %f\%", cor.test(p1,p2)$estimate, round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %f, coherence: %f %", cor.test(p1,p2)$estimate, round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %f, coherence: %f%", cor.test(p1,p2)$estimate, round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads)
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %f, coherence: %f", cor.test(p1,p2)$estimate, round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation(H1_enhancers, HeLa_enhancers,    reads_name = "valid sites", min_reads)
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %2f, coherence: %2f", cor.test(p1,p2)$estimate, round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %2f2, coherence: %2f2", cor.test(p1,p2)$estimate, round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %2f.2, coherence: %2f.2", cor.test(p1,p2)$estimate, round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %f, coherence: %f", round(cor.test(p1,p2)$estimate,2), round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %d, coherence: %d", round(cor.test(p1,p2)$estimate,2), round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %s, coherence: %s", round(cor.test(p1,p2)$estimate,2), round(coherent_sites_prop,3)))
}
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %s, coherence: %s", round(cor.test(p1,p2)$estimate,2), round(coherent_sites_prop,2)))
}
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
# Correlation
min_reads = 5
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation(H1_enhancers, HeLa_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "HeLa-S3"))
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "K562"))
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
{
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %s, coherence: %s", round(cor.test(p1,p2)$estimate,2), round(coherent_sites_prop,2)))
lines(x = c(0,100), y = c(50,50), lty = 2)
lines(x = c(50,50), y = c(0,100), lty = 2)
}
}
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
{
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %s, coherence: %s", round(cor.test(p1,p2)$estimate,2), round(coherent_sites_prop,2)))
lines(x = c(0,100), y = c(50,50), lty = 2, col = 2)
lines(x = c(50,50), y = c(0,100), lty = 2, col = 2)
}
}
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
{
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("correlation: %s, coherence: %s", round(cor.test(p1,p2)$estimate,2), round(coherent_sites_prop,2)))
lines(x = c(-100,200), y = c(50,50), lty = 2, col = 2)
lines(x = c(50,50), y = c(-100,200), lty = 2, col = 2)
}
}
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
# Correlation
min_reads = 5
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation(H1_enhancers, HeLa_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "HeLa-S3"))
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "K562"))
# Histograms
par(mfrow=c(1,3))
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation(H1_enhancers, HeLa_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "HeLa-S3"))
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "K562"))
# Histograms
par(mfrow=c(2,2))
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation(H1_enhancers, HeLa_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "HeLa-S3"))
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "K562"))
title("enhancers")
# Correlation
min_reads = 5
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation(H1_enhancers, HeLa_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "HeLa-S3"))
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "K562"))
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "K562"))
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "K562"))
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"))
annotation_level_meth_correlation(H1_enhancers, HeLa_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "HeLa-S3"))
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "K562"))
plot(main = "Enhancers Methylation Comparison")
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"), main = "Enhancers: ")
annotation_level_meth_correlation(H1_enhancers, HeLa_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "HeLa-S3"), main = "Enhancers: ")
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "K562"), main = "Enhancers: ")
annotation_level_meth_correlation <- function(data1, data2, reads_name, min_reads = 10, names, main)
{
mask = data1[, reads_name]>=min_reads & data2[, reads_name]>=min_reads
p1 = data1[mask, "prop"]
p2 = data2[mask, "prop"]
print(cor.test(p1,p2))
t = table(round(p1/100),round(p2/100))
cat("Table:\n")
print(t)
cat("\n\nproportion table:\n")
print(prop.table(t))
coherent_sites_prop = prop.table(t)[1] + prop.table(t)[4]
cat("\ncoherent_sites_prop: ", coherent_sites_prop)
different_sites_num = (t)[2] + (t)[3]
cat("\ndifferent_sites_num: ", different_sites_num)
if(length(p1)<1e5)
{
plot(p1,p2, col=alpha(1, 0.5), xlab = names[1], ylab = names[2], main = sprintf("%s correlation: %s, coherence: %s", main, round(cor.test(p1,p2)$estimate,2), round(coherent_sites_prop,2)))
lines(x = c(-100,200), y = c(50,50), lty = 2, col = 2)
lines(x = c(50,50), y = c(-100,200), lty = 2, col = 2)
}
}
# Correlation
min_reads = 5
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"), main = "Enhancers: ")
# Histograms
par(mfrow=c(2,2))
# Correlation
min_reads = 5
annotation_level_meth_correlation(H1_enhancers, stomach_enhancers, reads_name = "valid sites", min_reads, names = c("H1", "stomach"), main = "Enhancers: ")
annotation_level_meth_correlation(H1_enhancers, HeLa_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "HeLa-S3"), main = "Enhancers: ")
annotation_level_meth_correlation(H1_enhancers, K562_enhancers,    reads_name = "valid sites", min_reads, names = c("H1", "K562"), main = "Enhancers: ")
# Correlation
min_reads = 10
annotation_level_meth_correlation(H1_islands, stomach_islands, reads_name = "valid sites", min_reads=100, names = c("H1", "stomach"), main = "CG islands: ")
###################################################################
H1_islands      = readRDS("../../Rexperiments/H1_island_data.Rda")
stomach_islands = readRDS("../../Rexperiments/stomach_island_data.Rda")
K562_islands    = readRDS("../../Rexperiments/K562_island_data.Rda")
HeLa_islands    = readRDS("../../Rexperiments/HeLa_S3_island_data.Rda")
# Correlation
min_reads = 10
annotation_level_meth_correlation(H1_islands, stomach_islands, reads_name = "valid sites", min_reads=100, names = c("H1", "stomach"), main = "CG islands: ")
annotation_level_meth_correlation(H1_islands, HeLa_islands,    reads_name = "valid sites", min_reads=100, names = c("H1", "HeLa-S3"), main = "CG islands: ")
annotation_level_meth_correlation(H1_islands, K562_islands,    reads_name = "valid sites", min_reads=100, names = c("H1", "K562"), main = "CG islands: ")
# Histograms
par(mfrow=c(2,2))
# Histograms
par(mfrow=c(2,2))
# Correlation
min_reads = 10
annotation_level_meth_correlation(H1_islands, stomach_islands, reads_name = "valid sites", min_reads=100, names = c("H1", "stomach"), main = "CG islands: ")
annotation_level_meth_correlation(H1_islands, HeLa_islands,    reads_name = "valid sites", min_reads=100, names = c("H1", "HeLa-S3"), main = "CG islands: ")
annotation_level_meth_correlation(H1_islands, K562_islands,    reads_name = "valid sites", min_reads=100, names = c("H1", "K562"), main = "CG islands: ")
